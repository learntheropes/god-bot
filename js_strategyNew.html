<script>

  document.mainTf = '';
  document.additionalTfs = [];
  document.allTfs = [];
  document.indicators = {}
  
  var tfs = ['15m','30m','1h','2h','4h','1d','7d']
  
  var indicatorsDefault = {
    BOLL: {timeperiod: 20,sdn: 2},
    CCI: {timeperiod: 26},
    DMA: {timeperiodShort: 10,timeperiodLong: 50},
    DMI: {timeperiod: 14},
    SMA: {timeperiod: 30},
    EMA: {timeperiod: 30},
    MACD: {fastperiod: 12,slowperiod: 26,signalperiod: 9},
    MTM: {periods: 9},
    OBV : {},
    ROC: {periods: 12},
    RSI: {periods: 14},
    TRIX: {periods: 12}
  }
    
  window.onload = function() {
    loadMainTfHtml();
    loadIndicatorsAddHtml();
  }
  
  function loadMainTfHtml(){
    mainTfForm.innerHTML = '';
    tfs.map(function(tf) {
      var tfInput = document.createElement('input');
      tfInput.setAttribute('id',tf)
      tfInput.name = 'mainTf';
      tfInput.type = 'radio';
      tfInput.value = tf;
      var tfSpan = document.createElement('span');
      tfSpan.innerText = tf;
      var tfLabel = document.createElement('label');
      tfLabel.setAttribute('for',tf);
      tfLabel.appendChild(tfSpan);
      tfLabel.appendChild(tfInput);
      this.form.appendChild(tfLabel);
    }, {form: document.getElementById('mainTfForm')});
  };
  
  
  function mainTfActions() {
    var mainTf = getMainTfUserSelection();
    if (mainTf) {
      document.mainTf = mainTf;
      document.allTfs.push(mainTf);
      LoadAdditionalTfsHtml(mainTf);
    }
  }
  
  function getMainTfUserSelection() {
    return Array.prototype.slice.call(document.getElementsByName('mainTf'),0)
    .filter(function(radio) {
      return radio.checked;
    })
    .map(function(radio) {
      return radio.value;
    })[0];
  }
  
  function LoadAdditionalTfsHtml(mainTf) {
    additionalTfForm.innerHTML = '';
    tfs.filter(function(tf) {
      return document.mainTf !== tf;
    }).map(function(tf) {
      var tfInput = document.createElement('input');
      tfInput.name = "additionalTf";
      tfInput.type = "checkbox";
      tfInput.value = tf;
      var tfSpan = document.createElement('span');
      tfSpan.innerText = tf;
      var tfLabel = document.createElement('label');
      tfLabel.setAttribute('for',tf);
      tfLabel.appendChild(tfSpan);
      tfLabel.appendChild(tfInput);
      this.form.appendChild(tfLabel);
    }, {form: document.getElementById('additionalTfForm')});
  }
  
  function additionalTfActions() {
    var additionalTfs = getAdditionalTfUserSelection()
    document.additionalTfs = additionalTfs;
    document.allTfs = [document.mainTf].concat(additionalTfs);
  }
  
  function getAdditionalTfUserSelection() {
    return Array.prototype.slice.call(document.getElementsByName('additionalTf'),0)
    .filter(function(checkbox) {
      return checkbox.checked;
    })
    .map(function(checkbox) {
      return checkbox.value;
    });
  }
  
  function makeDropdown(name, pleaceholder, options) {
    var select = document.createElement('select');
    select.setAttribute('id', name + 'Dropdown');
    select.name = name;
    select.size = "1";
    var option = document.createElement('option');
    option.text = pleaceholder;
    option.value = "";
    option.setAttribute('selected',true);
    option.setAttribute('disabled',true);
    select.appendChild(option);
    options.map(function(opt) {
      var option = document.createElement('option');
      option.text = opt;
      option.value = opt;
      select.appendChild(option);
    })
    return select;  
  }
  
  function loadIndicatorsAddHtml() {
    var select = makeDropdown("indicators", "Select", Object.keys(indicatorsDefault))
    var parent = document.getElementById('indicatorsAddForm')
    parent.innerText = "Add Indicator: "
    parent.appendChild(select);
    
  }
  
  function addIndicatorToList() {
    var indicatorSlug = document.getElementById('indicatorsDropdown').value;
    var form = document.createElement('form');
    form.innerText = indicatorSlug;
    var dropdownTfs = makeDropdown("indicatorTimeframe", "Select timeframe", document.allTfs)
    Object.keys(indicatorsDefault[indicatorSlug]).map(function(key) {
      var div = document.createElement('div');
      div.setAttribute('class', 'field has-addons');
      var p1 = document.createElement('p');
       p1.setAttribute('class', 'control');
       var a = document.createElement('a');
       a.setAttribute('class', 'button is-static');
       a.innerText = key
       p1.appendChild(a)
       div.appendChild(p1)
       var p2 = document.createElement('p');
       p2.setAttribute('class', 'control');
       var input = document.createElement('input');
       input.setAttribute('class', 'input');
       input.setAttribute('type', 'text');
       input.setAttribute('placeholder', indicatorsDefault[indicatorSlug][key]);
       div.appendChild(input);
       form.appendChild(div);
       form.appendChild(dropdownTfs)
    })
    var remove = document.createElement('span');
    remove.setAttribute('class', 'button is-small');
    remove.setAttribute('type', 'Submit');
    remove.setAttribute('onclick', 'removeIndicator(this)');
    remove.innerText = "Remove";
    form.appendChild(remove);
    document.getElementById('indicatorsListDiv').appendChild(form);
  }

  function removeIndicator(input) {
    document.getElementById('indicatorsListDiv').removeChild(input.parentNode);
  }
</script>

